<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Filmfrei Serien</title>
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
  <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body {
      background-color: #121212;
      color: #F5F5F5;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    header {
      padding: 20px;
      font-size: 24px;
      font-weight: bold;
      background-color: #1A1A1A;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    main {
      padding: 20px;
    }
    .series-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 20px;
    }
    .series-card {
      background-color: #1E1E1E;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.3s;
    }
    .series-card:hover {
      transform: scale(1.05);
    }
    .series-card img {
      width: 100%;
      height: auto;
      display: block;
    }
    .series-title {
      padding: 10px;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
    }
    .series-detail-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .series-detail-container {
      background-color: #1A1A1A;
      border-radius: 12px;
      padding: 20px;
      width: 90%;
      max-width: 1000px;
      position: relative;
      display: flex;
      flex-direction: row;
      gap: 20px;
    }
    .series-detail-left {
      flex: 1;
    }
    .series-detail-right {
      flex: 2;
    }
    .series-cover-img {
      width: 100%;
      border-radius: 12px;
    }
    .series-description {
      margin-top: 10px;
      font-size: 14px;
      color: #ccc;
    }
    .close-detail {
      position: absolute;
      top: 15px; right: 15px;
      background: rgba(255,255,255,0.1);
      border: none;
      border-radius: 50%;
      width: 30px; height: 30px;
      font-size: 18px;
      cursor: pointer;
      color: #fff;
    }
    select, button {
      margin-top: 10px;
      width: 100%;
      padding: 10px;
      background: #0A84FF;
      border: none;
      border-radius: 8px;
      color: #fff;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: #0066cc;
    }
    .episode-list {
      margin-top: 15px;
    }
    .episode-item {
      margin-bottom: 10px;
      padding: 10px;
      background: #2A2A2A;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .episode-item:hover {
      background: #3A3A3A;
    }
    iframe {
      margin-top: 20px;
      width: 100%;
      height: 400px;
      border: none;
      border-radius: 12px;
      background: #000;
    }
    .loader {
      border: 8px solid #333;
      border-top: 8px solid #fff;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
      display: none;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <header>Filmfrei – Serien</header>
  <main>
    <div class="series-grid" id="seriesGrid"></div>
  </main>

  <div class="series-detail-overlay" id="seriesOverlay">
    <div class="series-detail-container">
      <button class="close-detail" id="closeDetail">×</button>
      <div class="series-detail-left">
        <img id="seriesCover" class="series-cover-img" src="" alt="">
        <p id="seriesDescription" class="series-description"></p>
      </div>
      <div class="series-detail-right">
        <h2 id="seriesTitle"></h2>
        <select id="seasonSelect"></select>
        <button id="showEpisodesBtn">Folgen anzeigen</button>
        <div class="episode-list" id="episodeList"></div>
        <div id="loader" class="loader"></div>
        <iframe id="episodePlayer" allowfullscreen sandbox="allow-scripts allow-same-origin allow-presentation"></iframe>
      </div>
    </div>
  </div>

  <script>
    const serien = [
  {
    "titel": "The Last of Us",
    "beschreibung": "Nachdem die Zivilisation durch eine globale Pandemie zerstört wurde, kümmert sich ein abgehärteter Überlebender um ein 14-jähriges Mädchen, das vielleicht die letzte Hoffnung für die Menschheit ist.",
    "cover": "https://musicart.xboxlive.com/7/55286400-0000-0000-0000-000000000002/504/image.jpg",
    "staffeln": [
      {
        "nummer": 1,
        "folgen": [
          {
            "titel": "Wenn du in der Dunkelheit verloren bist",
            "iframe": "https://supervideo.cc/e/011rzgozpd5p"
          },
          {
            "titel": "Infiziert",
            "iframe": "https://supervideo.cc/e/b54co0tktq5n"
          },
          {
            "titel": "Liebe mich, wie ich es will",
            "iframe": "https://supervideo.cc/e/sodj5p52ahud"
          },
          {
            "titel": "Niemand wird uns finden",
            "iframe": "https://supervideo.cc/e/viwxep4q6jt2"
          },
          {
            "titel": "Ertragen und Überleben",
            "iframe": "https://supervideo.cc/e/akoozv6j8gj0"
          },
          {
            "titel": "Familie",
            "iframe": "https://supervideo.cc/e/nhmpvp9ggx5n"
          },
          {
            "titel": "Zurückgelassen",
            "iframe": "https://supervideo.cc/e/d2xbu99r3slf"
          },
          {
            "titel": "Wenn wir in Not sind",
            "iframe": "https://supervideo.cc/e/d09sqtjzlxjn"
          },
          {
            "titel": "Suche nach dem Licht",
            "iframe": "https://supervideo.cc/e/aakpvzxafg6q"
          }
        ]
      }
    ]
  }
    ];

    const seriesGrid = document.getElementById('seriesGrid');
    const seriesOverlay = document.getElementById('seriesOverlay');
    const seriesTitle = document.getElementById('seriesTitle');
    const seriesCover = document.getElementById('seriesCover');
    const seriesDescription = document.getElementById('seriesDescription');
    const seasonSelect = document.getElementById('seasonSelect');
    const showEpisodesBtn = document.getElementById('showEpisodesBtn');
    const episodeList = document.getElementById('episodeList');
    const episodePlayer = document.getElementById('episodePlayer');
    const loader = document.getElementById('loader');
    const closeDetail = document.getElementById('closeDetail');

    serien.forEach(serie => {
      const card = document.createElement('div');
      card.className = 'series-card';
      card.innerHTML = `
        <img src="${serie.cover}" alt="${serie.titel}">
        <div class="series-title">${serie.titel}</div>
      `;
      card.addEventListener('click', () => openSeriesDetail(serie));
      seriesGrid.appendChild(card);
    });

    function openSeriesDetail(serie) {
      seriesOverlay.style.display = 'flex';
      seriesTitle.textContent = serie.titel;
      seriesCover.src = serie.cover;
      seriesCover.alt = serie.titel;
      seriesDescription.textContent = serie.beschreibung || "";
      seasonSelect.innerHTML = '';
      episodeList.innerHTML = '';
      episodePlayer.style.display = 'none';

      serie.staffeln.forEach(staffel => {
        const option = document.createElement('option');
        option.value = staffel.nummer;
        option.textContent = `Staffel ${staffel.nummer}`;
        seasonSelect.appendChild(option);
      });

      showEpisodesBtn.onclick = () => {
        const selectedSeason = serie.staffeln.find(s => s.nummer == seasonSelect.value);
        if (selectedSeason) {
          episodeList.innerHTML = '';
          selectedSeason.folgen.forEach(folge => {
            const item = document.createElement('div');
            item.className = 'episode-item';
            item.textContent = folge.titel;
            item.addEventListener('click', () => playEpisode(folge.iframe));
            episodeList.appendChild(item);
          });
        }
      };
    }

    function playEpisode(iframeUrl) {
      loader.style.display = 'block';
      episodePlayer.style.display = 'none';
      episodePlayer.src = iframeUrl;

      episodePlayer.onload = () => {
        loader.style.display = 'none';
        episodePlayer.style.display = 'block';
        try {
          episodePlayer.contentWindow.open = function() {
            console.warn('Popup geblockt!');
            return null;
          };
        } catch (e) {
          console.warn('Cross-Origin, kann window.open nicht blockieren.');
        }
      };
    }

    closeDetail.addEventListener('click', () => {
      seriesOverlay.style.display = 'none';
      episodePlayer.src = '';
    });
  </script>
</body>
</html>
